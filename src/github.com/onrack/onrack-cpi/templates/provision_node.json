{
    "friendlyName": "Provision Node",
    "implementsTask": "Task.Base.Linux.Commands",
    "injectableName": "Task.Os.Install.CF.Stemcell",
    "options": {
      "agentSettingsFile": null,
      "agentSettingsMd5Uri": "{{ api.files }}/md5/{{ options.agentSettingsFile }}/latest",
      "agentSettingsPath": null,
      "agentSettingsUri": "{{ api.files }}/{{ options.agentSettingsFile }}/latest",
      "commands": [
        "curl --retry 3 {{ options.stemcellUri }} -o {{ options.downloadDir }}/{{ options.stemcellFile }}",
        "test `curl {{ options.stemcellFileMd5Uri }}` = \\\"`md5sum {{ options.downloadDir }}/{{ options.stemcellFile }}| awk '{print $1}'`\\\"",
        "curl --retry 3 {{ options.agentSettingsUri }} -o {{ options.downloadDir }}/{{ options.agentSettingsFile }}",
        "test `curl {{ options.agentSettingsMd5Uri }}` = \\\"`md5sum {{ options.downloadDir }}/{{ options.agentSettingsFile }}| awk '{print $1}'`\\\"",
        "curl --retry 3 {{ options.registrySettingsUri }} -o {{ options.downloadDir }}/{{ options.registrySettingsFile }}",
        "test `curl {{ options.registrySettingsMd5Uri }}` = \\\"`md5sum {{ options.downloadDir }}/{{ options.registrySettingsFile }}| awk '{print $1}'`\\\"",
        "sudo qemu-img convert {{ options.downloadDir }}/{{ options.stemcellFile }} -O raw {{ options.device }}",
        "sudo mount {{ options.device }}1 /mnt",
        "sudo cp {{ options.downloadDir }}/{{ options.agentSettingsFile }} /mnt/{{ options.agentSettingsPath }}",
        "sudo cp {{ options.downloadDir }}/{{ options.registrySettingsFile }} /mnt/{{ options.registrySettingsPath }}",
        "sudo sync"
      ],
      "device": "/dev/sda",
      "downloadDir": "/opt/downloads",
      "registrySettingsFile": null,
      "registrySettingsMd5Uri": "{{ api.files }}/md5/{{ options.registrySettingsFile }}/latest",
      "registrySettingsPath": null,
      "registrySettingsUri": "{{ api.files }}/{{ options.registrySettingsFile }}/latest",
      "stemcellFile": null,
      "stemcellFileMd5Uri": "{{ api.files }}/md5/{{ options.stemcellFile }}/latest",
      "stemcellUri": "{{ api.files }}/{{ options.stemcellFile }}/latest"
    },
    "properties": {}
}
